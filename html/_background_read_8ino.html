<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>INA2xx: examples/BackgroundRead/BackgroundRead.ino File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">INA2xx
   &#160;<span id="projectnumber">Version 1.0.8</span>
   </div>
   <div id="projectbrief">Arduino Library for INA2xx power measurement devices</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_background_read_8ino.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">BackgroundRead.ino File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Example program for the INA Library demonstrating background reads.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="_i_n_a_8h_source.html">INA.h</a>&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa64c6dce15e9de9105b4ae9533c9a267"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_background_read_8ino.html#aa64c6dce15e9de9105b4ae9533c9a267">ISR</a> (PCINT0_vect)</td></tr>
<tr class="memdesc:aa64c6dce15e9de9105b4ae9533c9a267"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt service routine for the PCINT0_vect.  <a href="#aa64c6dce15e9de9105b4ae9533c9a267">More...</a><br /></td></tr>
<tr class="separator:aa64c6dce15e9de9105b4ae9533c9a267"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fc01d736fe50cf5b977f755b675f11d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_background_read_8ino.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a> ()</td></tr>
<tr class="memdesc:a4fc01d736fe50cf5b977f755b675f11d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Arduino method called once at startup to initialize the system.  <a href="#a4fc01d736fe50cf5b977f755b675f11d">More...</a><br /></td></tr>
<tr class="separator:a4fc01d736fe50cf5b977f755b675f11d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_background_read_8ino.html#afe461d27b9c48d5921c00d521181f12f">loop</a> ()</td></tr>
<tr class="memdesc:afe461d27b9c48d5921c00d521181f12f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Arduino method for the main program loop.  <a href="#afe461d27b9c48d5921c00d521181f12f">More...</a><br /></td></tr>
<tr class="separator:afe461d27b9c48d5921c00d521181f12f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:af0b8bdc479bf42af4e35a7a31b857373"><td class="memItemLeft" align="right" valign="top"><a id="af0b8bdc479bf42af4e35a7a31b857373"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_background_read_8ino.html#af0b8bdc479bf42af4e35a7a31b857373">INA_ALERT_PIN</a> = 8</td></tr>
<tr class="memdesc:af0b8bdc479bf42af4e35a7a31b857373"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pin-Change pin used for the INA "ALERT" functionality. <br /></td></tr>
<tr class="separator:af0b8bdc479bf42af4e35a7a31b857373"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cc57301563e3c5c906dbad9f19a7d94"><td class="memItemLeft" align="right" valign="top"><a id="a4cc57301563e3c5c906dbad9f19a7d94"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_background_read_8ino.html#a4cc57301563e3c5c906dbad9f19a7d94">GREEN_LED_PIN</a> = 13</td></tr>
<tr class="memdesc:a4cc57301563e3c5c906dbad9f19a7d94"><td class="mdescLeft">&#160;</td><td class="mdescRight">Arduino standard green LED. <br /></td></tr>
<tr class="separator:a4cc57301563e3c5c906dbad9f19a7d94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc8430dea1bce949f10d9708742cca34"><td class="memItemLeft" align="right" valign="top"><a id="adc8430dea1bce949f10d9708742cca34"></a>
const uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_background_read_8ino.html#adc8430dea1bce949f10d9708742cca34">SERIAL_SPEED</a> = 115200</td></tr>
<tr class="memdesc:adc8430dea1bce949f10d9708742cca34"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use fast serial speed. <br /></td></tr>
<tr class="separator:adc8430dea1bce949f10d9708742cca34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67d666137ef9b3c8b6d60b6f1dbf6970"><td class="memItemLeft" align="right" valign="top"><a id="a67d666137ef9b3c8b6d60b6f1dbf6970"></a>
<a class="el" href="class_i_n_a___class.html">INA_Class</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_background_read_8ino.html#a67d666137ef9b3c8b6d60b6f1dbf6970">INA</a></td></tr>
<tr class="memdesc:a67d666137ef9b3c8b6d60b6f1dbf6970"><td class="mdescLeft">&#160;</td><td class="mdescRight">INA class instantiation. <br /></td></tr>
<tr class="separator:a67d666137ef9b3c8b6d60b6f1dbf6970"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa288141c88c2063ca23516ce595d6a94"><td class="memItemLeft" align="right" valign="top"><a id="aa288141c88c2063ca23516ce595d6a94"></a>
volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_background_read_8ino.html#aa288141c88c2063ca23516ce595d6a94">deviceNumber</a> = UINT8_MAX</td></tr>
<tr class="memdesc:aa288141c88c2063ca23516ce595d6a94"><td class="mdescLeft">&#160;</td><td class="mdescRight">Device Number to use in example, init used for detection loop. <br /></td></tr>
<tr class="separator:aa288141c88c2063ca23516ce595d6a94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6505ef3b8859931529079f24ba25054e"><td class="memItemLeft" align="right" valign="top"><a id="a6505ef3b8859931529079f24ba25054e"></a>
volatile uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_background_read_8ino.html#a6505ef3b8859931529079f24ba25054e">sumBusMillVolts</a> = 0</td></tr>
<tr class="memdesc:a6505ef3b8859931529079f24ba25054e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sum of bus voltage readings. <br /></td></tr>
<tr class="separator:a6505ef3b8859931529079f24ba25054e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fdb94b9f9a7329cf8b69ba8e81c04a4"><td class="memItemLeft" align="right" valign="top"><a id="a8fdb94b9f9a7329cf8b69ba8e81c04a4"></a>
volatile int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_background_read_8ino.html#a8fdb94b9f9a7329cf8b69ba8e81c04a4">sumBusMicroAmps</a> = 0</td></tr>
<tr class="memdesc:a8fdb94b9f9a7329cf8b69ba8e81c04a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sum of bus amperage readings. <br /></td></tr>
<tr class="separator:a8fdb94b9f9a7329cf8b69ba8e81c04a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ec15d11de9a04bef54462745f3aa1a8"><td class="memItemLeft" align="right" valign="top"><a id="a9ec15d11de9a04bef54462745f3aa1a8"></a>
volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_background_read_8ino.html#a9ec15d11de9a04bef54462745f3aa1a8">readings</a> = 0</td></tr>
<tr class="memdesc:a9ec15d11de9a04bef54462745f3aa1a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of measurements taken. <br /></td></tr>
<tr class="separator:a9ec15d11de9a04bef54462745f3aa1a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Example program for the INA Library demonstrating background reads. </p>
<h1><a class="anchor" id="BackgroundRead_section"></a>
Description</h1>
<p>Program to demonstrate using the interrupt pin of any INA2xx which supports that functionality. It uses a pin-change interrupt handler and programs any INA2xx found to to read voltage and current information in the background while allowing the main Arduino code to continue processing normally until it is ready to consume the readings.<br />
<br />
 The example program uses the Arduino AVR-based interrupt mechanism and will not function on other platforms<br />
<br />
 Detailed documentation can be found on the GitHub Wiki pages at <a href="https://github.com/SV-Zanshin/INA/wiki">https://github.com/SV-Zanshin/INA/wiki</a> <br />
<br />
Since the INA library allows multiple devices of different types and this program demonstrates interrupts and background processing, it will limit itself to using the first INA226 detected. This is easily changed in the if another device type or device number to test is required.<br />
 This example is for a INA226 set up to measure a 5-Volt load with a 0.1Ohm resistor in place, this is the same setup that can be found in the Adafruit INA226 breakout board. The complex calibration options are done at runtime using the 2 parameters specified in the "begin()" call and the library has gone to great lengths to avoid the use of floating point to conserve space and minimize runtime. This demo program uses floating point only to convert and display the data conveniently. The INA226 uses 15 bits of precision, and even though the current and watt information is returned using 32-bit integers the precision remains the same.<br />
The INA226 is set up to measure using the maximum conversion length (and maximum accuracy) and then average those readings 64 times. This results in readings taking 8.244ms x 64 = 527.616ms or just less than 2 times a second. The pin-change interrupt handler is called when a reading is finished and the INA226 pulls the pin down to ground, it resets the pin status and adds the readings to the global variables. The main program will do whatever processing it has to and every 5 seconds it will display the current averaged readings and reset them.<br />
 The datasheet for the INA226 can be found at <a href="http://www.ti.com/lit/ds/symlink/INA226.pdf">http://www.ti.com/lit/ds/symlink/INA226.pdf</a> and it contains the information required in order to hook up the device. Unfortunately it comes as a VSSOP package but it can be soldered onto a breakout board for breadboard use. The INA226 is quite similar to the INA219 mentioned above, but it can take bus voltages of up to 36V (which I needed in order to monitor a 24V battery system which goes above 28V while charging and which is above the absolute limits of the INA219). It is also significantly more accurate than the INA219, plus has an alert pin.<br />
The interrupt is set to pin 8. The tests were done on an Arduino Micro, and the Atmel 82U4 chip only allows pin change interrupt on selected pins (SS,SCK,MISO,MOSI,8) so pin 8 was chosen.</p>
<h1><a class="anchor" id="BackgroundRead_license"></a>
GNU General Public License v3.0</h1>
<p>This program is free software : you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.You should have received a copy of the GNU General Public License along with this program(see <a href="https://github.com/SV-Zanshin/INA/blob/master/LICENSE">https://github.com/SV-Zanshin/INA/blob/master/LICENSE</a>). If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>
<h1><a class="anchor" id="BackgroundRead_author"></a>
Author</h1>
<p>Written by Arnd@SV-Zanshin</p>
<h1><a class="anchor" id="BackgroundRead_versions"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version </th><th>Date </th><th>Developer </th><th>Comments  </th></tr>
<tr>
<td>1.0.4 </td><td>2019-02-16 </td><td><a href="https://github.com/SV-Zanshin">https://github.com/SV-Zanshin</a> </td><td>ifdef so that sketch won't compile on incompatible platforms </td></tr>
<tr>
<td>1.0.3 </td><td>2019-01-09 </td><td><a href="https://github.com/SV-Zanshin">https://github.com/SV-Zanshin</a> </td><td>Cleaned up doxygen formatting </td></tr>
<tr>
<td>1.0.2 </td><td>2018-12-28 </td><td><a href="https://github.com/SV-Zanshin">https://github.com/SV-Zanshin</a> </td><td>Converted comments to doxygen format </td></tr>
<tr>
<td>1.0.0 </td><td>2018-06-23 </td><td><a href="https://github.com/SV-Zanshin">https://github.com/SV-Zanshin</a> </td><td>Cloned and adapted example from old deprecated INA226 </td></tr>
</table>
<p>library </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aa64c6dce15e9de9105b4ae9533c9a267"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa64c6dce15e9de9105b4ae9533c9a267">&#9670;&nbsp;</a></span>ISR()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR </td>
          <td>(</td>
          <td class="paramtype">PCINT0_vect&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interrupt service routine for the PCINT0_vect. </p>
<p>Routine is called whenever the INA_ALERT_PIN changes value </p>

</div>
</div>
<a id="afe461d27b9c48d5921c00d521181f12f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe461d27b9c48d5921c00d521181f12f">&#9670;&nbsp;</a></span>loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void loop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Arduino method for the main program loop. </p>
<p>This is the main program for the Arduino IDE, it is called in an infinite loop. The INA226 measurements are triggered by the interrupt handler each time a conversion is ready and stored in variables.The main infinite doesn't call any INA library functions, that is done in the interrupt handler. Each time 10 readings have been collected the program will output the averaged values and measurements resume from that point onwards </p><dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a4fc01d736fe50cf5b977f755b675f11d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fc01d736fe50cf5b977f755b675f11d">&#9670;&nbsp;</a></span>setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Arduino method called once at startup to initialize the system. </p>
<p>This is an Arduino IDE method which is called first upon boot or restart. It is only called one time and then control goes to the main "loop()" method, from which control never returns </p><dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d28a4824dc47e487b107a5db32ef43c4.html">examples</a></li><li class="navelem"><a class="el" href="dir_bbb27c2ef2aa6cd43804f9e42f285558.html">BackgroundRead</a></li><li class="navelem"><a class="el" href="_background_read_8ino.html">BackgroundRead.ino</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
